<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç¶²ç«™ç”Ÿæˆå™¨ - AiInPocket | 30 ç§’æ‰“é€ å°ˆå±¬ç¶²ç«™</title>
    <meta name="description" content="ä½¿ç”¨ AI æŠ€è¡“ï¼Œ30 ç§’å…§ç”Ÿæˆå°ˆæ¥­ç¶²ç«™ã€‚é¸æ“‡é¢¨æ ¼ã€å¡«å¯«è³‡æ–™ï¼Œç«‹å³ç²å¾—æ‚¨çš„å°ˆå±¬ç¶²ç«™ã€‚">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* ========================================
           ç”Ÿæˆå™¨å°ˆç”¨æ¨£å¼
           ======================================== */

        /* é€²åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: fixed;
            top: 80px;
            left: 0;
            width: 100%;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            z-index: 90;
            padding: 1.5rem 0;
            border-bottom: 1px solid rgba(135, 206, 235, 0.2);
        }

        .progress-steps {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 15%;
            right: 15%;
            height: 2px;
            background: rgba(135, 206, 235, 0.2);
            z-index: -1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            position: relative;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(135, 206, 235, 0.1);
            border: 2px solid rgba(135, 206, 235, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .progress-step.active .step-circle {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            border-color: var(--primary-green);
            color: var(--dark-bg);
            box-shadow: 0 0 20px var(--glow-green);
        }

        .progress-step.completed .step-circle {
            background: rgba(127, 255, 0, 0.2);
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .step-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: center;
        }

        .progress-step.active .step-label {
            color: var(--primary-green);
            font-weight: 600;
        }

        /* ä¸»å…§å®¹å€åŸŸ */
        .generator-content {
            padding-top: 160px;
            min-height: 100vh;
        }

        /* æ­¡è¿å€åŸŸ */
        .welcome-section {
            text-align: center;
            padding: 3rem 0;
            max-width: 800px;
            margin: 0 auto;
        }

        .welcome-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .time-badge {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            background: rgba(127, 255, 0, 0.1);
            border: 1px solid var(--primary-green);
            border-radius: 50px;
            color: var(--primary-green);
            font-weight: 600;
            font-size: 0.95rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* å€å¡Šå®¹å™¨ */
        .section-block {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .section-block.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* é¢¨æ ¼é¸æ“‡å€åŸŸ */
        .style-section {
            padding: 3rem 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: 2.5rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .section-header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .styles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .style-card {
            background: var(--card-bg);
            border: 2px solid rgba(135, 206, 235, 0.2);
            border-radius: var(--radius-lg);
            padding: 2rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .style-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--glow-green) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .style-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-blue);
            box-shadow: 0 10px 30px var(--glow-blue);
        }

        .style-card.selected {
            border-color: var(--primary-green);
            background: var(--card-hover-bg);
            box-shadow: 0 15px 40px var(--glow-green);
        }

        .style-card.selected::before {
            opacity: 0.1;
        }

        .style-card.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: var(--primary-green);
            color: var(--dark-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .style-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .style-name {
            font-size: 1.3rem;
            color: var(--primary-blue);
            margin-bottom: 0.7rem;
            font-weight: 600;
        }

        .style-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .style-colors {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .color-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .style-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .style-tag {
            padding: 0.3rem 0.8rem;
            background: rgba(135, 206, 235, 0.1);
            border: 1px solid var(--primary-blue);
            border-radius: 15px;
            font-size: 0.75rem;
            color: var(--primary-blue);
        }

        /* è‡ªè¨‚é¢¨æ ¼å€åŸŸ */
        .custom-style-area {
            display: none;
            margin-top: 3rem;
            padding: 2.5rem;
            background: var(--card-bg);
            border: 2px solid var(--primary-green);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
        }

        .custom-style-area.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .upload-area {
            border: 2px dashed rgba(135, 206, 235, 0.4);
            border-radius: var(--radius-md);
            padding: 3rem;
            text-align: center;
            transition: var(--transition);
            margin-bottom: 2rem;
            position: relative;
            cursor: pointer;
        }

        .upload-area.dragover {
            border-color: var(--primary-green);
            background: rgba(127, 255, 0, 0.05);
            box-shadow: 0 0 20px var(--glow-green);
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background: rgba(135, 206, 235, 0.05);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .image-preview {
            display: none;
            max-width: 100%;
            border-radius: var(--radius-md);
            margin-top: 1rem;
        }

        .image-preview.show {
            display: block;
        }

        /* å•å·è¡¨å–®å€åŸŸ */
        .form-section {
            padding: 3rem 0;
        }

        .generator-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-field {
            margin-bottom: 2rem;
        }

        .form-field label {
            display: block;
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 0.7rem;
            font-weight: 500;
        }

        .form-field label .required {
            color: var(--primary-green);
            margin-left: 0.3rem;
        }

        .form-field input,
        .form-field textarea,
        .form-field select {
            width: 100%;
            background: rgba(135, 206, 235, 0.05);
            border: 1px solid rgba(135, 206, 235, 0.3);
            border-radius: var(--radius-sm);
            padding: 1rem 1.2rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-field input:focus,
        .form-field textarea:focus,
        .form-field select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 15px var(--glow-green);
            background: rgba(127, 255, 0, 0.05);
        }

        .form-field textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-field.error input,
        .form-field.error textarea,
        .form-field.error select {
            border-color: #ff4444;
        }

        .error-message {
            color: #ff4444;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-field.error .error-message {
            display: block;
        }

        /* å‹•æ…‹åˆ—è¡¨ */
        .dynamic-list {
            margin-top: 1rem;
        }

        .list-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .list-item input {
            flex: 1;
        }

        .btn-remove {
            padding: 0.8rem 1.2rem;
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff4444;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-remove:hover {
            background: rgba(255, 68, 68, 0.2);
            transform: scale(1.05);
        }

        .btn-add {
            margin-top: 1rem;
            padding: 0.8rem 1.5rem;
            background: rgba(135, 206, 235, 0.1);
            border: 1px solid var(--primary-blue);
            color: var(--primary-blue);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
        }

        .btn-add:hover {
            background: rgba(135, 206, 235, 0.2);
            transform: translateY(-2px);
        }

        /* Checkbox æ¨£å¼ */
        .checkbox-field {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(135, 206, 235, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(135, 206, 235, 0.2);
            cursor: pointer;
            transition: var(--transition);
        }

        .checkbox-field:hover {
            background: rgba(135, 206, 235, 0.1);
            border-color: var(--primary-blue);
        }

        .checkbox-field input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--primary-green);
        }

        .checkbox-field label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        /* ä½œå“é›†é …ç›® */
        .portfolio-items {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: rgba(127, 255, 0, 0.05);
            border: 1px solid rgba(127, 255, 0, 0.2);
            border-radius: var(--radius-md);
        }

        .portfolio-items.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .portfolio-item-block {
            background: var(--card-bg);
            border: 1px solid rgba(135, 206, 235, 0.2);
            border-radius: var(--radius-md);
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .portfolio-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .portfolio-item-title {
            color: var(--primary-green);
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* ä½œå“é›†åœ–ç‰‡ä¸Šå‚³æ¨£å¼ */
        .portfolio-image-upload {
            border: 2px dashed rgba(135, 206, 235, 0.4);
            border-radius: var(--radius-md);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(135, 206, 235, 0.02);
        }

        .portfolio-image-upload:hover {
            border-color: var(--primary-blue);
            background: rgba(135, 206, 235, 0.05);
        }

        .upload-placeholder {
            width: 100%;
        }

        .portfolio-image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--radius-sm);
            object-fit: contain;
        }

        /* å°èˆªæŒ‰éˆ• */
        .navigation-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 1px solid rgba(135, 206, 235, 0.2);
        }

        .btn-nav {
            flex: 1;
            max-width: 250px;
            padding: 1.2rem 2rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            justify-content: center;
        }

        .btn-next {
            margin-left: auto;
        }

        /* æäº¤æŒ‰éˆ• */
        .submit-section {
            text-align: center;
            padding: 4rem 0;
            max-width: 600px;
            margin: 0 auto;
        }

        .submit-title {
            font-size: 2rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .submit-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .btn-generate {
            padding: 1.5rem 4rem;
            font-size: 1.3rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: var(--dark-bg);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .btn-generate:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 50px var(--glow-green);
        }

        .btn-generate:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .estimate-time {
            display: block;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            color: var(--primary-green);
            font-family: 'Courier New', monospace;
        }

        /* Loading ç‹€æ…‹ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 39, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 100px;
            height: 100px;
            border: 4px solid rgba(135, 206, 235, 0.2);
            border-top-color: var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 2rem;
            font-size: 1.5rem;
            color: var(--primary-blue);
            text-align: center;
        }

        .loading-progress {
            margin-top: 1rem;
            font-size: 1.1rem;
            color: var(--primary-green);
            font-family: 'Courier New', monospace;
        }

        /* æˆåŠŸè¨Šæ¯ */
        .success-message {
            display: none;
            text-align: center;
            padding: 4rem 2rem;
        }

        .success-message.active {
            display: block;
        }

        .success-icon {
            font-size: 5rem;
            color: var(--primary-green);
            margin-bottom: 2rem;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-title {
            font-size: 2.5rem;
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .success-description {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .website-preview {
            margin: 3rem auto;
            padding: 2rem;
            background: var(--card-bg);
            border: 2px solid var(--primary-green);
            border-radius: var(--radius-lg);
            max-width: 600px;
        }

        .preview-url {
            font-size: 1.1rem;
            color: var(--primary-blue);
            word-break: break-all;
            padding: 1rem;
            background: rgba(135, 206, 235, 0.1);
            border-radius: var(--radius-sm);
            font-family: 'Courier New', monospace;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .generator-content {
                padding-top: 200px;
            }

            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }

            .progress-steps::before {
                display: none;
            }

            .welcome-title {
                font-size: 2rem;
            }

            .styles-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .navigation-buttons {
                flex-direction: column;
            }

            .btn-nav {
                max-width: 100%;
            }

            .btn-next {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- ç²’å­èƒŒæ™¯å®¹å™¨ -->
    <canvas id="particles-canvas"></canvas>

    <!-- å°èˆªåˆ— -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html" style="text-decoration: none;">
                    <span class="logo-text">AiInPocket</span>
                    <span class="logo-subtext">å£è¢‹æ™ºæ…§</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">é¦–é </a></li>
                <li><a href="portfolio.html">ä½œå“é›†</a></li>
                <li><a href="tech-stack.html">æŠ€è¡“æ£§</a></li>
                <li><a href="about.html">é—œæ–¼æˆ‘å€‘</a></li>
                <li><a href="contact.html">è¯çµ¡æˆ‘å€‘</a></li>
                <li><a href="generator.html" class="active nav-cta">ç¶²ç«™ç”Ÿæˆå™¨</a></li>
                <li id="user-menu-item" style="display: none;">
                    <a href="#" id="my-projects-btn">æˆ‘çš„ä½œå“</a>
                </li>
                <li>
                    <a href="#" id="login-btn" class="nav-cta">ç™»å…¥</a>
                    <a href="#" id="user-email-display" style="display: none;"></a>
                </li>
            </ul>
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- é€²åº¦æŒ‡ç¤ºå™¨ -->
    <div class="progress-indicator">
        <div class="progress-steps">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">é¸æ“‡é¢¨æ ¼</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">å¡«å¯«è³‡æ–™</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">ç”Ÿæˆç¶²ç«™</div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <main class="main-content generator-content">
        <div class="container">
            <!-- æ­¡è¿å€åŸŸ -->
            <div class="welcome-section">
                <h1 class="welcome-title">AI ç¶²ç«™ç”Ÿæˆå™¨</h1>
                <p class="welcome-subtitle">
                    é‹ç”¨æœ€æ–° AI æŠ€è¡“ï¼Œ30 ç§’å…§ç‚ºæ‚¨æ‰“é€ å°ˆæ¥­ã€ç¾è§€çš„å°ˆå±¬ç¶²ç«™ã€‚<br>
                    ç„¡éœ€ä»»ä½•ç¨‹å¼çŸ¥è­˜ï¼Œåªéœ€ç°¡å–®ä¸‰æ­¥é©Ÿï¼Œå³å¯æ“æœ‰é«˜å“è³ªçš„ç¶²è·¯å½¢è±¡ã€‚
                </p>
                <div class="time-badge">âš¡ é ä¼°æ™‚é–“ï¼š30-60 ç§’</div>
            </div>

            <!-- æ­¥é©Ÿ 1: é¢¨æ ¼é¸æ“‡ -->
            <section class="section-block active" id="step-1">
                <div class="style-section">
                    <div class="section-header">
                        <h2>ç¬¬ä¸€æ­¥ï¼šé¸æ“‡ç¶²ç«™é¢¨æ ¼</h2>
                        <p>å¾ 25+ ç¨®ç²¾å¿ƒè¨­è¨ˆçš„æ¨¡æ¿ä¸­é¸æ“‡ï¼Œæˆ–ä¸Šå‚³åœ–ç‰‡è‡ªè¨‚å°ˆå±¬é¢¨æ ¼</p>
                    </div>

                    <div class="styles-grid" id="styles-grid">
                        <!-- é¢¨æ ¼å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>

                    <!-- è‡ªè¨‚é¢¨æ ¼å€åŸŸ -->
                    <div class="custom-style-area" id="custom-style-area">
                        <h3 style="color: var(--primary-green); margin-bottom: 2rem; font-size: 1.5rem;">è‡ªè¨‚æ‚¨çš„å°ˆå±¬é¢¨æ ¼</h3>

                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">ğŸ“¸</div>
                            <div class="upload-text">é»æ“Šæˆ–æ‹–æ”¾åœ–ç‰‡åˆ°æ­¤è™•</div>
                            <div class="upload-hint">æ”¯æ´ JPG, PNG, GIFï¼ˆæœ€å¤§ 5MBï¼‰</div>
                            <input type="file" id="image-upload" accept="image/*" style="display: none;">
                            <img id="image-preview" class="image-preview" alt="Preview">
                        </div>

                        <div class="form-field">
                            <label for="custom-description">
                                é¢¨æ ¼æè¿°
                                <span style="font-size: 0.85rem; color: var(--text-muted);">ï¼ˆæè¿°æ‚¨æƒ³è¦çš„è¦–è¦ºé¢¨æ ¼ã€é…è‰²ã€æ°›åœç­‰ï¼‰</span>
                            </label>
                            <textarea
                                id="custom-description"
                                placeholder="ä¾‹å¦‚ï¼šç°¡ç´„ç¾ä»£é¢¨æ ¼ï¼Œä½¿ç”¨æŸ”å’Œçš„è—ç¶ è‰²èª¿ï¼Œçµ¦äººå°ˆæ¥­åˆè¦ªåˆ‡çš„æ„Ÿè¦º..."
                                rows="4"
                            ></textarea>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-primary btn-nav btn-next" onclick="nextStep(2)">
                            ä¸‹ä¸€æ­¥
                            <span>â†’</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- æ­¥é©Ÿ 2: å¡«å¯«è³‡æ–™ -->
            <section class="section-block" id="step-2">
                <div class="form-section">
                    <div class="section-header">
                        <h2>ç¬¬äºŒæ­¥ï¼šå¡«å¯«ç¶²ç«™è³‡æ–™</h2>
                        <p>æä¾›æ‚¨çš„å…¬å¸æˆ–å“ç‰Œè³‡è¨Šï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨ç”Ÿæˆå®Œç¾çš„ç¶²ç«™å…§å®¹</p>
                    </div>

                    <form class="generator-form" id="generator-form">
                        <!-- åŸºæœ¬è³‡è¨Š -->
                        <div class="form-row">
                            <div class="form-field">
                                <label for="company-name">
                                    å…¬å¸/å“ç‰Œåç¨±<span class="required">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="company-name"
                                    name="companyName"
                                    placeholder="ä¾‹å¦‚ï¼šå‰µæ–°ç§‘æŠ€æœ‰é™å…¬å¸"
                                    required
                                >
                                <div class="error-message">è«‹è¼¸å…¥å…¬å¸/å“ç‰Œåç¨±</div>
                            </div>

                            <div class="form-field">
                                <label for="slogan">
                                    æ¨™èª/å£è™Ÿ
                                    <span style="font-size: 0.85rem; color: var(--text-muted);">ï¼ˆé¸å¡«ï¼‰</span>
                                </label>
                                <input
                                    type="text"
                                    id="slogan"
                                    name="slogan"
                                    placeholder="ä¾‹å¦‚ï¼šå‰µæ–°å¼•é ˜æœªä¾†"
                                >
                            </div>
                        </div>

                        <!-- å…¬å¸æè¿° -->
                        <div class="form-field">
                            <label for="company-description">
                                å…¬å¸/å“ç‰Œæè¿°<span class="required">*</span>
                            </label>
                            <textarea
                                id="company-description"
                                name="companyDescription"
                                placeholder="è«‹ç°¡è¿°æ‚¨çš„å…¬å¸æ¥­å‹™ã€ç‰¹è‰²ã€é¡˜æ™¯ç­‰..."
                                rows="5"
                                required
                            ></textarea>
                            <div class="error-message">è«‹è¼¸å…¥å…¬å¸/å“ç‰Œæè¿°</div>
                        </div>

                        <!-- æœå‹™åˆ—è¡¨ -->
                        <div class="form-field">
                            <label>
                                æä¾›çš„æœå‹™/ç”¢å“<span class="required">*</span>
                            </label>
                            <div class="dynamic-list" id="services-list">
                                <div class="list-item">
                                    <input
                                        type="text"
                                        name="service[]"
                                        placeholder="ä¾‹å¦‚ï¼šç¶²ç«™é–‹ç™¼"
                                        required
                                    >
                                    <button type="button" class="btn-remove" onclick="removeItem(this)">åˆªé™¤</button>
                                </div>
                                <div class="list-item">
                                    <input
                                        type="text"
                                        name="service[]"
                                        placeholder="ä¾‹å¦‚ï¼šAPP è¨­è¨ˆ"
                                        required
                                    >
                                    <button type="button" class="btn-remove" onclick="removeItem(this)">åˆªé™¤</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-add" onclick="addService()">+ æ–°å¢æœå‹™</button>
                            <div class="error-message">è«‹è‡³å°‘æä¾›ä¸€é …æœå‹™</div>
                        </div>

                        <!-- è¯çµ¡è³‡è¨Š -->
                        <div class="form-row">
                            <div class="form-field">
                                <label for="contact-email">
                                    è¯çµ¡ Email<span class="required">*</span>
                                </label>
                                <input
                                    type="email"
                                    id="contact-email"
                                    name="contactEmail"
                                    placeholder="contact@example.com"
                                    required
                                >
                                <div class="error-message">è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email åœ°å€</div>
                            </div>

                            <div class="form-field">
                                <label for="contact-phone">
                                    è¯çµ¡é›»è©±
                                    <span style="font-size: 0.85rem; color: var(--text-muted);">ï¼ˆé¸å¡«ï¼‰</span>
                                </label>
                                <input
                                    type="tel"
                                    id="contact-phone"
                                    name="contactPhone"
                                    placeholder="02-1234-5678"
                                >
                            </div>
                        </div>

                        <!-- ä½œå“é›†é¸é … -->
                        <div class="checkbox-field" onclick="toggleCheckbox('need-portfolio')">
                            <input
                                type="checkbox"
                                id="need-portfolio"
                                name="needPortfolio"
                                onclick="event.stopPropagation(); togglePortfolio()"
                            >
                            <label for="need-portfolio">
                                éœ€è¦ä½œå“é›†å€å¡Š
                                <span style="display: block; font-size: 0.85rem; color: var(--text-muted); margin-top: 0.3rem;">
                                    å±•ç¤ºæ‚¨çš„æˆåŠŸæ¡ˆä¾‹æˆ–ä»£è¡¨ä½œå“
                                </span>
                            </label>
                        </div>

                        <!-- ä½œå“é›†é …ç›®ï¼ˆæ¢ä»¶é¡¯ç¤ºï¼‰ -->
                        <div class="portfolio-items" id="portfolio-items">
                            <h3 style="color: var(--primary-green); margin-bottom: 2rem;">ä½œå“é›†é …ç›®</h3>
                            <div id="portfolio-list">
                                <!-- ä½œå“é›†é …ç›®å°‡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <button type="button" class="btn btn-add" onclick="addPortfolioItem()">+ æ–°å¢ä½œå“</button>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <button class="btn btn-secondary btn-nav" onclick="previousStep(1)">
                            <span>â†</span>
                            ä¸Šä¸€æ­¥
                        </button>
                        <button class="btn btn-primary btn-nav btn-next" onclick="nextStep(3)">
                            ä¸‹ä¸€æ­¥
                            <span>â†’</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- æ­¥é©Ÿ 3: ç”Ÿæˆç¶²ç«™ -->
            <section class="section-block" id="step-3">
                <div class="submit-section">
                    <h2 class="submit-title">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
                    <p class="submit-description">
                        ç¢ºèªæ‚¨çš„è³‡æ–™å¾Œï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œ<br>
                        æˆ‘å€‘å°‡ç«‹å³ä½¿ç”¨ AI ç‚ºæ‚¨ç”Ÿæˆå°ˆå±¬ç¶²ç«™ï¼
                    </p>
                    <button class="btn-generate" onclick="generateWebsite()">
                        ğŸš€ ç«‹å³ç”Ÿæˆç¶²ç«™
                    </button>
                    <span class="estimate-time">é ä¼°ç”Ÿæˆæ™‚é–“ï¼š30-60 ç§’</span>
                </div>

                <div class="navigation-buttons" style="margin-top: 3rem;">
                    <button class="btn btn-secondary btn-nav" onclick="previousStep(2)">
                        <span>â†</span>
                        ä¸Šä¸€æ­¥
                    </button>
                </div>
            </section>

            <!-- æˆåŠŸè¨Šæ¯ -->
            <section class="success-message" id="success-message">
                <div class="success-icon">âœ¨</div>
                <h2 class="success-title">ç¶²ç«™ç”ŸæˆæˆåŠŸï¼</h2>
                <p class="success-description">
                    æ­å–œï¼æ‚¨çš„å°ˆå±¬ç¶²ç«™å·²ç¶“æº–å‚™å°±ç·’ã€‚<br>
                    é»æ“Šä¸‹æ–¹é€£çµå³å¯æŸ¥çœ‹æ‚¨çš„æ–°ç¶²ç«™ã€‚
                </p>
                <div class="website-preview">
                    <div style="margin-bottom: 1rem; color: var(--text-secondary);">æ‚¨çš„ç¶²ç«™åœ°å€ï¼š</div>
                    <div class="preview-url" id="website-url">https://aiinpocket.com/sites/your-website</div>
                </div>
                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="#" class="btn btn-primary" id="visit-website">
                        è¨ªå•ç¶²ç«™
                        <span>â†’</span>
                    </a>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        å†ç”Ÿæˆä¸€å€‹
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Loading è¦†è“‹å±¤ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">AI æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆå°ˆå±¬ç¶²ç«™...</div>
        <div class="loading-progress" id="loading-progress">0%</div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>AiInPocket</h3>
                    <p class="footer-tagline">è®“æ™ºæ…§è§¸æ‰‹å¯åŠ</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>æœå‹™</h4>
                        <ul>
                            <li><a href="portfolio.html">ä½œå“é›†</a></li>
                            <li><a href="tech-stack.html">æŠ€è¡“æ£§</a></li>
                            <li><a href="about.html">é—œæ–¼æˆ‘å€‘</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>è¯çµ¡</h4>
                        <ul>
                            <li><a href="contact.html">è¯çµ¡æˆ‘å€‘</a></li>
                            <li><a href="mailto:help@aiinpocket.com">Email</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AiInPocket. All rights reserved.</p>
                <p class="footer-note">/// Powered by AI & Innovation ///</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/particles.js"></script>
    <script src="js/main.js"></script>

    <script>
        // ========================================
        // å…¨åŸŸè®Šæ•¸
        // ========================================
        let currentStep = 1;
        let selectedStyle = null;
        let uploadedImage = null;
        let portfolioItemCount = 0;

        // ========================================
        // 25+ ç¨®æ¨¡æ¿é¢¨æ ¼å®šç¾©
        // ========================================
        const templateStyles = [
            {
                id: 'modern-tech',
                name: 'ç¾ä»£ç§‘æŠ€',
                icon: 'ğŸ’»',
                description: 'ç°¡æ½”çš„è¨­è¨ˆæ­é…ç§‘æŠ€æ„Ÿé…è‰²ï¼Œé©åˆç§‘æŠ€å…¬å¸èˆ‡æ–°å‰µåœ˜éšŠ',
                colors: ['#2563eb', '#3b82f6', '#60a5fa'],
                tags: ['ç§‘æŠ€', 'å°ˆæ¥­', 'ç¾ä»£']
            },
            {
                id: 'business-pro',
                name: 'å•†å‹™å°ˆæ¥­',
                icon: 'ğŸ’¼',
                description: 'ç©©é‡å¤§æ°£çš„ä¼æ¥­é¢¨æ ¼ï¼Œå±•ç¾å°ˆæ¥­èˆ‡å¯ä¿¡åº¦',
                colors: ['#1e3a8a', '#1e40af', '#3730a3'],
                tags: ['å•†å‹™', 'ä¼æ¥­', 'å°ˆæ¥­']
            },
            {
                id: 'creative-agency',
                name: 'å‰µæ„è¨­è¨ˆ',
                icon: 'ğŸ¨',
                description: 'å¤§è†½æ´»æ½‘çš„è‰²å½©èˆ‡æ’ç‰ˆï¼Œå±•ç¾å‰µæ„èˆ‡æ´»åŠ›',
                colors: ['#ec4899', '#f97316', '#f59e0b'],
                tags: ['å‰µæ„', 'è¨­è¨ˆ', 'æ´»æ½‘']
            },
            {
                id: 'minimal-clean',
                name: 'æ¥µç°¡ä¸»ç¾©',
                icon: 'âšª',
                description: 'ç´”ç²¹çš„ç•™ç™½ç¾å­¸ï¼Œç°¡ç´„è€Œä¸ç°¡å–®',
                colors: ['#000000', '#ffffff', '#6b7280'],
                tags: ['æ¥µç°¡', 'ç´”æ·¨', 'å„ªé›…']
            },
            {
                id: 'nature-eco',
                name: 'è‡ªç„¶ç’°ä¿',
                icon: 'ğŸŒ¿',
                description: 'æ¸…æ–°çš„ç¶ è‰²ç³»ï¼Œå‚³éç’°ä¿èˆ‡å¥åº·ç†å¿µ',
                colors: ['#059669', '#10b981', '#34d399'],
                tags: ['ç’°ä¿', 'è‡ªç„¶', 'å¥åº·']
            },
            {
                id: 'luxury-gold',
                name: 'å¥¢è¯å°Šè²´',
                icon: 'ğŸ‘‘',
                description: 'é‡‘è‰²èˆ‡é»‘è‰²çš„ç¶“å…¸çµ„åˆï¼Œå±•ç¾é«˜ç«¯å“å‘³',
                colors: ['#d97706', '#b45309', '#92400e'],
                tags: ['å¥¢è¯', 'é«˜ç«¯', 'å°Šè²´']
            },
            {
                id: 'startup-bold',
                name: 'æ–°å‰µæ´»åŠ›',
                icon: 'ğŸš€',
                description: 'å……æ»¿å‹•æ„Ÿçš„è¨­è¨ˆï¼Œå½°é¡¯å‰µæ–°èˆ‡çªç ´ç²¾ç¥',
                colors: ['#7c3aed', '#8b5cf6', '#a78bfa'],
                tags: ['æ–°å‰µ', 'å‰µæ–°', 'æ´»åŠ›']
            },
            {
                id: 'medical-care',
                name: 'é†«ç™‚å¥åº·',
                icon: 'ğŸ¥',
                description: 'æ¸…çˆ½çš„è—ç™½è‰²èª¿ï¼Œå‚³éå°ˆæ¥­èˆ‡ä¿¡ä»»æ„Ÿ',
                colors: ['#0ea5e9', '#06b6d4', '#22d3ee'],
                tags: ['é†«ç™‚', 'å¥åº·', 'å°ˆæ¥­']
            },
            {
                id: 'education-learn',
                name: 'æ•™è‚²å­¸ç¿’',
                icon: 'ğŸ“š',
                description: 'æº«æš–çš„é…è‰²èˆ‡å‹å–„çš„è¨­è¨ˆï¼Œé©åˆæ•™è‚²æ©Ÿæ§‹',
                colors: ['#f59e0b', '#eab308', '#facc15'],
                tags: ['æ•™è‚²', 'å­¸ç¿’', 'å‹å–„']
            },
            {
                id: 'food-restaurant',
                name: 'é¤é£²ç¾é£Ÿ',
                icon: 'ğŸ½ï¸',
                description: 'èª˜äººçš„è‰²èª¿èˆ‡è¦–è¦ºï¼Œæ¿€ç™¼é£Ÿæ…¾èˆ‡èˆˆè¶£',
                colors: ['#dc2626', '#ef4444', '#f87171'],
                tags: ['é¤é£²', 'ç¾é£Ÿ', 'æº«æš–']
            },
            {
                id: 'fashion-style',
                name: 'æ™‚å°šæ½®æµ',
                icon: 'ğŸ‘—',
                description: 'å‰è¡›çš„è¨­è¨ˆèªè¨€ï¼Œå±•ç¾æ™‚å°šå“å‘³',
                colors: ['#db2777', '#e11d48', '#f43f5e'],
                tags: ['æ™‚å°š', 'æ½®æµ', 'å‰è¡›']
            },
            {
                id: 'finance-trust',
                name: 'é‡‘èç†è²¡',
                icon: 'ğŸ’°',
                description: 'ç©©å®šå¯é çš„è¦–è¦ºè¨­è¨ˆï¼Œå»ºç«‹ä¿¡ä»»æ„Ÿ',
                colors: ['#065f46', '#047857', '#059669'],
                tags: ['é‡‘è', 'ä¿¡ä»»', 'ç©©å®š']
            },
            {
                id: 'sports-fitness',
                name: 'é‹å‹•å¥èº«',
                icon: 'ğŸ’ª',
                description: 'å……æ»¿æ´»åŠ›çš„è¨­è¨ˆï¼Œæ¿€ç™¼é‹å‹•ç†±æƒ…',
                colors: ['#ea580c', '#f97316', '#fb923c'],
                tags: ['é‹å‹•', 'å¥èº«', 'æ´»åŠ›']
            },
            {
                id: 'travel-adventure',
                name: 'æ—…éŠæ¢éšª',
                icon: 'âœˆï¸',
                description: 'è¼•é¬†æ„‰æ‚…çš„è‰²èª¿ï¼Œå–šèµ·æ—…è¡Œæ…¾æœ›',
                colors: ['#0284c7', '#0ea5e9', '#38bdf8'],
                tags: ['æ—…éŠ', 'æ¢éšª', 'è‡ªç”±']
            },
            {
                id: 'real-estate',
                name: 'æˆ¿åœ°ç”¢',
                icon: 'ğŸ ',
                description: 'å¤§æ°£ç©©é‡çš„è¨­è¨ˆï¼Œå±•ç¾å¯¦åŠ›èˆ‡å“è³ª',
                colors: ['#334155', '#475569', '#64748b'],
                tags: ['æˆ¿åœ°ç”¢', 'å°ˆæ¥­', 'ç©©é‡']
            },
            {
                id: 'automotive',
                name: 'æ±½è»Šç”¢æ¥­',
                icon: 'ğŸš—',
                description: 'å‹•æ„Ÿæµç·šçš„è¨­è¨ˆï¼Œå±•ç¾é€Ÿåº¦èˆ‡ç§‘æŠ€',
                colors: ['#1e293b', '#374151', '#4b5563'],
                tags: ['æ±½è»Š', 'å‹•æ„Ÿ', 'ç§‘æŠ€']
            },
            {
                id: 'beauty-spa',
                name: 'ç¾å®¹ç¾é«”',
                icon: 'ğŸ’†',
                description: 'æŸ”å’Œèˆ’é©çš„è‰²èª¿ï¼Œç‡Ÿé€ æ”¾é¬†æ°›åœ',
                colors: ['#f0abfc', '#e879f9', '#d946ef'],
                tags: ['ç¾å®¹', 'æ”¾é¬†', 'èˆ’é©']
            },
            {
                id: 'wedding-event',
                name: 'å©šç¦®æ´»å‹•',
                icon: 'ğŸ’',
                description: 'æµªæ¼«å„ªé›…çš„è¨­è¨ˆï¼Œæ•æ‰å¹¸ç¦æ™‚åˆ»',
                colors: ['#fda4af', '#fb7185', '#f43f5e'],
                tags: ['å©šç¦®', 'æµªæ¼«', 'å„ªé›…']
            },
            {
                id: 'legal-law',
                name: 'æ³•å¾‹æœå‹™',
                icon: 'âš–ï¸',
                description: 'èŠé‡å°ˆæ¥­çš„è¦–è¦ºï¼Œå±•ç¾æ¬Šå¨èˆ‡ä¿¡ä»»',
                colors: ['#1e40af', '#1e3a8a', '#1e293b'],
                tags: ['æ³•å¾‹', 'å°ˆæ¥­', 'æ¬Šå¨']
            },
            {
                id: 'photography',
                name: 'æ”å½±è—è¡“',
                icon: 'ğŸ“·',
                description: 'æ³¨é‡è¦–è¦ºè¡¨ç¾ï¼Œè®“ä½œå“æˆç‚ºç„¦é»',
                colors: ['#000000', '#ffffff', '#f59e0b'],
                tags: ['æ”å½±', 'è—è¡“', 'è¦–è¦º']
            },
            {
                id: 'music-entertainment',
                name: 'éŸ³æ¨‚å¨›æ¨‚',
                icon: 'ğŸµ',
                description: 'å‹•æ„Ÿç¯€å¥çš„è¨­è¨ˆï¼Œå±•ç¾éŸ³æ¨‚é­…åŠ›',
                colors: ['#8b5cf6', '#7c3aed', '#6d28d9'],
                tags: ['éŸ³æ¨‚', 'å¨›æ¨‚', 'å‹•æ„Ÿ']
            },
            {
                id: 'nonprofit-charity',
                name: 'å…¬ç›Šæ…ˆå–„',
                icon: 'â¤ï¸',
                description: 'æº«æš–äººå¿ƒçš„è¨­è¨ˆï¼Œå‚³éæ„›èˆ‡é—œæ‡·',
                colors: ['#f87171', '#ef4444', '#dc2626'],
                tags: ['å…¬ç›Š', 'æ…ˆå–„', 'æº«æš–']
            },
            {
                id: 'pet-animal',
                name: 'å¯µç‰©æœå‹™',
                icon: 'ğŸ¾',
                description: 'å¯æ„›å‹å–„çš„è¨­è¨ˆï¼Œå±•ç¾å°å¯µç‰©çš„æ„›',
                colors: ['#fbbf24', '#f59e0b', '#d97706'],
                tags: ['å¯µç‰©', 'å¯æ„›', 'å‹å–„']
            },
            {
                id: 'kids-children',
                name: 'å…’ç«¥ç”¢å“',
                icon: 'ğŸ§¸',
                description: 'ç¹½ç´›æ´»æ½‘çš„è‰²å½©ï¼Œå¸å¼•å…’ç«¥ç›®å…‰',
                colors: ['#34d399', '#fbbf24', '#f472b6'],
                tags: ['å…’ç«¥', 'ç¹½ç´›', 'æ´»æ½‘']
            },
            {
                id: 'cyber-security',
                name: 'è³‡å®‰ç§‘æŠ€',
                icon: 'ğŸ”',
                description: 'ç§‘æŠ€æ„Ÿèˆ‡å®‰å…¨æ„Ÿä¸¦é‡çš„è¦–è¦ºè¨­è¨ˆ',
                colors: ['#0f172a', '#1e293b', '#0ea5e9'],
                tags: ['è³‡å®‰', 'ç§‘æŠ€', 'å®‰å…¨']
            },
            {
                id: 'custom',
                name: 'è‡ªè¨‚é¢¨æ ¼',
                icon: 'ğŸ¯',
                description: 'ä¸Šå‚³åœ–ç‰‡æˆ–æè¿°ï¼Œæ‰“é€ ç¨ä¸€ç„¡äºŒçš„å°ˆå±¬é¢¨æ ¼',
                colors: ['#87CEEB', '#7FFF00', '#4A90E2'],
                tags: ['è‡ªè¨‚', 'ç¨ç‰¹', 'å°ˆå±¬']
            }
        ];

        // ========================================
        // åˆå§‹åŒ–
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeStyles();
            initializeUpload();
            initializeNavigation();
        });

        // ========================================
        // ç”Ÿæˆé¢¨æ ¼å¡ç‰‡
        // ========================================
        function initializeStyles() {
            const stylesGrid = document.getElementById('styles-grid');

            templateStyles.forEach(style => {
                const card = document.createElement('div');
                card.className = 'style-card';
                card.setAttribute('data-style-id', style.id);
                card.onclick = () => selectStyle(style.id);

                card.innerHTML = `
                    <div class="style-icon">${style.icon}</div>
                    <div class="style-name">${style.name}</div>
                    <div class="style-description">${style.description}</div>
                    <div class="style-colors">
                        ${style.colors.map(color => `<div class="color-dot" style="background: ${color};"></div>`).join('')}
                    </div>
                    <div class="style-tags">
                        ${style.tags.map(tag => `<span class="style-tag">${tag}</span>`).join('')}
                    </div>
                `;

                stylesGrid.appendChild(card);
            });
        }

        // ========================================
        // é¸æ“‡é¢¨æ ¼
        // ========================================
        function selectStyle(styleId) {
            // ç§»é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.style-card').forEach(card => {
                card.classList.remove('selected');
            });

            // é¸ä¸­ç•¶å‰é¢¨æ ¼
            const selectedCard = document.querySelector(`[data-style-id="${styleId}"]`);
            selectedCard.classList.add('selected');
            selectedStyle = styleId;

            // é¡¯ç¤ºæˆ–éš±è—è‡ªè¨‚å€åŸŸ
            const customArea = document.getElementById('custom-style-area');
            if (styleId === 'custom') {
                customArea.classList.add('active');
            } else {
                customArea.classList.remove('active');
            }
        }

        // ========================================
        // åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½
        // ========================================
        function initializeUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('image-upload');
            const preview = document.getElementById('image-preview');

            // é»æ“Šä¸Šå‚³
            uploadArea.addEventListener('click', () => fileInput.click());

            // æª”æ¡ˆé¸æ“‡
            fileInput.addEventListener('change', handleFileSelect);

            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // æª¢æŸ¥æª”æ¡ˆé¡å‹
            if (!file.type.startsWith('image/')) {
                alert('è«‹ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆ');
                return;
            }

            // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆ5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
                alert('åœ–ç‰‡å¤§å°ä¸èƒ½è¶…é 5MB');
                return;
            }

            // è®€å–ä¸¦é è¦½åœ–ç‰‡
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('image-preview');
                preview.src = e.target.result;
                preview.classList.add('show');
                uploadedImage = e.target.result;

                // å¦‚æœéœ€è¦ï¼Œå¯ä»¥å‘¼å« API åˆ†æåœ–ç‰‡
                analyzeImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // ========================================
        // ä½œå“é›†åœ–ç‰‡è™•ç†ï¼ˆè‡ªå‹•å£“ç¸®èˆ‡èª¿æ•´å¤§å°ï¼‰
        // ========================================
        async function handlePortfolioImageUpload(input, itemId) {
            const file = input.files[0];
            if (!file) return;

            // æª¢æŸ¥æª”æ¡ˆé¡å‹
            if (!file.type.startsWith('image/')) {
                alert('è«‹ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆ');
                input.value = '';
                return;
            }

            // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆ10MBï¼‰
            if (file.size > 10 * 1024 * 1024) {
                alert('åœ–ç‰‡å¤§å°ä¸èƒ½è¶…é 10MB');
                input.value = '';
                return;
            }

            // é¡¯ç¤ºè™•ç†ä¸­æç¤º
            const placeholder = document.getElementById(`placeholder-${itemId}`);
            const preview = document.getElementById(`preview-${itemId}`);
            placeholder.innerHTML = '<div class="upload-icon">â³</div><div class="upload-text">è™•ç†ä¸­...</div>';

            try {
                // å£“ç¸®ä¸¦èª¿æ•´åœ–ç‰‡å¤§å°
                const optimizedImage = await optimizeImage(file);

                // é¡¯ç¤ºé è¦½
                preview.src = optimizedImage;
                preview.style.display = 'block';
                placeholder.style.display = 'none';

                // å„²å­˜ base64 è³‡æ–™
                document.getElementById(`portfolio-image-data-${itemId}`).value = optimizedImage;

            } catch (error) {
                console.error('åœ–ç‰‡è™•ç†å¤±æ•—:', error);
                alert('åœ–ç‰‡è™•ç†å¤±æ•—ï¼Œè«‹é‡è©¦æˆ–é¸æ“‡å…¶ä»–åœ–ç‰‡');
                placeholder.innerHTML = `
                    <div class="upload-icon">ğŸ“¸</div>
                    <div class="upload-text">é»æ“Šä¸Šå‚³ä½œå“åœ–ç‰‡</div>
                    <div class="upload-hint">æ”¯æ´ JPG, PNG, WebPï¼ˆæœ€å¤§ 10MBï¼Œè‡ªå‹•å„ªåŒ–ï¼‰</div>
                `;
                input.value = '';
            }
        }

        /**
         * å„ªåŒ–åœ–ç‰‡ - è‡ªå‹•èª¿æ•´å¤§å°å’Œå£“ç¸®
         * @param {File} file - åŸå§‹åœ–ç‰‡æª”æ¡ˆ
         * @returns {Promise<string>} - Base64 ç·¨ç¢¼çš„å„ªåŒ–åœ–ç‰‡
         */
        async function optimizeImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    const img = new Image();

                    img.onload = () => {
                        // è¨­å®šæœ€å¤§å°ºå¯¸é™åˆ¶ï¼ˆé¿å…æ’ç‰ˆè·‘æ‰ï¼‰
                        const MAX_WIDTH = 1200;   // æœ€å¤§å¯¬åº¦
                        const MAX_HEIGHT = 800;   // æœ€å¤§é«˜åº¦
                        const QUALITY = 0.85;     // å£“ç¸®å“è³ª (0.85 = 85%)

                        let width = img.width;
                        let height = img.height;

                        // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹
                        if (width > MAX_WIDTH || height > MAX_HEIGHT) {
                            const ratio = Math.min(MAX_WIDTH / width, MAX_HEIGHT / height);
                            width = Math.floor(width * ratio);
                            height = Math.floor(height * ratio);
                        }

                        // å»ºç«‹ Canvas é€²è¡Œå£“ç¸®
                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');

                        // ä½¿ç”¨æ›´å¥½çš„åœ–ç‰‡ç¸®æ”¾æ¼”ç®—æ³•
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';

                        // ç¹ªè£½åœ–ç‰‡
                        ctx.drawImage(img, 0, 0, width, height);

                        // è½‰æ›ç‚º Base64ï¼ˆä½¿ç”¨ JPEG æ ¼å¼ä»¥ç²å¾—æ›´å¥½çš„å£“ç¸®ç‡ï¼‰
                        const optimizedBase64 = canvas.toBlob((blob) => {
                            const reader2 = new FileReader();
                            reader2.onloadend = () => {
                                const result = reader2.result;

                                // æª¢æŸ¥å£“ç¸®å¾Œçš„å¤§å°
                                const sizeInKB = Math.round((result.length * 3 / 4) / 1024);
                                console.log(`åœ–ç‰‡å„ªåŒ–å®Œæˆ: ${img.width}x${img.height} -> ${width}x${height}, ${sizeInKB}KB`);

                                resolve(result);
                            };
                            reader2.readAsDataURL(blob);
                        }, 'image/jpeg', QUALITY);
                    };

                    img.onerror = () => {
                        reject(new Error('ç„¡æ³•è¼‰å…¥åœ–ç‰‡'));
                    };

                    img.src = e.target.result;
                };

                reader.onerror = () => {
                    reject(new Error('ç„¡æ³•è®€å–æª”æ¡ˆ'));
                };

                reader.readAsDataURL(file);
            });
        }

        // ========================================
        // åœ–ç‰‡åˆ†æï¼ˆå‘¼å«å¾Œç«¯ APIï¼‰
        // ========================================
        async function analyzeImage(imageData) {
            try {
                const response = await fetch('/api/analyze-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        image_base64: imageData.split(',')[1], // å»æ‰ data:image/xxx;base64, å‰ç¶´
                        description: document.getElementById('custom-description')?.value || ''
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    // å¯ä»¥æ ¹æ“šåˆ†æçµæœè‡ªå‹•å¡«å……æè¿°
                    if (result.suggestion) {
                        document.getElementById('custom-description').value = result.suggestion;
                    }
                }
            } catch (error) {
                console.error('åœ–ç‰‡åˆ†æå¤±æ•—:', error);
                // ä¸å½±éŸ¿ä¸»æµç¨‹ï¼Œåƒ…è¨˜éŒ„éŒ¯èª¤
            }
        }

        // ========================================
        // å°èˆªåŠŸèƒ½
        // ========================================
        function initializeNavigation() {
            // æ‰‹æ©Ÿç‰ˆé¸å–®
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.querySelector('.nav-menu');

            if (navToggle) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
        }

        function nextStep(step) {
            // é©—è­‰ç•¶å‰æ­¥é©Ÿ
            if (step === 2 && !validateStep1()) {
                return;
            }

            if (step === 3 && !validateStep2()) {
                return;
            }

            // æ›´æ–°æ­¥é©Ÿ
            updateStep(step);
        }

        function previousStep(step) {
            updateStep(step);
        }

        function updateStep(step) {
            // éš±è—æ‰€æœ‰å€å¡Š
            document.querySelectorAll('.section-block').forEach(block => {
                block.classList.remove('active');
            });

            // é¡¯ç¤ºç›®æ¨™å€å¡Š
            document.getElementById(`step-${step}`).classList.add('active');

            // æ›´æ–°é€²åº¦æŒ‡ç¤ºå™¨
            document.querySelectorAll('.progress-step').forEach(stepEl => {
                stepEl.classList.remove('active', 'completed');
                const stepNum = parseInt(stepEl.getAttribute('data-step'));
                if (stepNum < step) {
                    stepEl.classList.add('completed');
                } else if (stepNum === step) {
                    stepEl.classList.add('active');
                }
            });

            currentStep = step;

            // æ»¾å‹•åˆ°é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // é©—è­‰æ­¥é©Ÿ 1
        // ========================================
        function validateStep1() {
            if (!selectedStyle) {
                alert('è«‹é¸æ“‡ä¸€å€‹ç¶²ç«™é¢¨æ ¼');
                return false;
            }

            if (selectedStyle === 'custom') {
                const description = document.getElementById('custom-description').value.trim();
                if (!uploadedImage && !description) {
                    alert('è«‹ä¸Šå‚³åœ–ç‰‡æˆ–å¡«å¯«é¢¨æ ¼æè¿°');
                    return false;
                }
            }

            return true;
        }

        // ========================================
        // é©—è­‰æ­¥é©Ÿ 2
        // ========================================
        function validateStep2() {
            let isValid = true;

            // é©—è­‰å¿…å¡«æ¬„ä½
            const requiredFields = [
                { id: 'company-name', name: 'å…¬å¸/å“ç‰Œåç¨±' },
                { id: 'company-description', name: 'å…¬å¸æè¿°' },
                { id: 'contact-email', name: 'è¯çµ¡ Email' }
            ];

            requiredFields.forEach(field => {
                const input = document.getElementById(field.id);
                const formField = input.closest('.form-field');

                if (!input.value.trim()) {
                    formField.classList.add('error');
                    isValid = false;
                } else {
                    formField.classList.remove('error');
                }
            });

            // é©—è­‰ Email æ ¼å¼
            const email = document.getElementById('contact-email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email.value && !emailRegex.test(email.value)) {
                email.closest('.form-field').classList.add('error');
                isValid = false;
            }

            // é©—è­‰æœå‹™åˆ—è¡¨
            const services = document.querySelectorAll('input[name="service[]"]');
            let hasService = false;
            services.forEach(service => {
                if (service.value.trim()) {
                    hasService = true;
                }
            });

            if (!hasService) {
                alert('è«‹è‡³å°‘æä¾›ä¸€é …æœå‹™');
                isValid = false;
            }

            return isValid;
        }

        // ========================================
        // å‹•æ…‹åˆ—è¡¨åŠŸèƒ½
        // ========================================
        function addService() {
            const list = document.getElementById('services-list');
            const newItem = document.createElement('div');
            newItem.className = 'list-item';
            newItem.innerHTML = `
                <input
                    type="text"
                    name="service[]"
                    placeholder="è¼¸å…¥æœå‹™åç¨±"
                >
                <button type="button" class="btn-remove" onclick="removeItem(this)">åˆªé™¤</button>
            `;
            list.appendChild(newItem);
        }

        function removeItem(button) {
            const listItem = button.closest('.list-item');
            const list = listItem.parentElement;

            // è‡³å°‘ä¿ç•™ä¸€å€‹é …ç›®
            if (list.children.length > 1) {
                listItem.remove();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹é …ç›®');
            }
        }

        // ========================================
        // Checkbox åˆ‡æ›
        // ========================================
        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
            if (id === 'need-portfolio') {
                togglePortfolio();
            }
        }

        function togglePortfolio() {
            const checkbox = document.getElementById('need-portfolio');
            const portfolioItems = document.getElementById('portfolio-items');

            if (checkbox.checked) {
                portfolioItems.classList.add('active');
                // è‡ªå‹•æ·»åŠ ç¬¬ä¸€å€‹ä½œå“é …ç›®
                if (portfolioItemCount === 0) {
                    addPortfolioItem();
                }
            } else {
                portfolioItems.classList.remove('active');
            }
        }

        function addPortfolioItem() {
            portfolioItemCount++;
            const list = document.getElementById('portfolio-list');
            const item = document.createElement('div');
            item.className = 'portfolio-item-block';
            const itemId = `portfolio-item-${portfolioItemCount}`;
            item.setAttribute('data-item-id', portfolioItemCount);
            item.innerHTML = `
                <div class="portfolio-item-header">
                    <div class="portfolio-item-title">ä½œå“ #${portfolioItemCount}</div>
                    <button type="button" class="btn-remove" onclick="removePortfolioItem(this)">åˆªé™¤</button>
                </div>
                <div class="form-field">
                    <label>ä½œå“åç¨±</label>
                    <input type="text" name="portfolio-name[]" placeholder="ä¾‹å¦‚ï¼šä¼æ¥­å®˜ç¶²è¨­è¨ˆ">
                </div>
                <div class="form-field">
                    <label>ä½œå“æè¿°</label>
                    <textarea name="portfolio-description[]" placeholder="ç°¡è¿°ä½œå“ç‰¹è‰²èˆ‡æˆæœ..." rows="3"></textarea>
                </div>
                <div class="form-field">
                    <label>
                        ä½œå“åœ–ç‰‡
                        <span style="font-size: 0.85rem; color: var(--text-muted);">ï¼ˆé¸å¡«ï¼Œåœ–ç‰‡æœƒè‡ªå‹•å„ªåŒ–è‡³é©ç•¶å¤§å°ï¼‰</span>
                    </label>
                    <div class="portfolio-image-upload" onclick="document.getElementById('portfolio-image-${portfolioItemCount}').click()">
                        <div class="upload-placeholder" id="placeholder-${portfolioItemCount}">
                            <div class="upload-icon">ğŸ“¸</div>
                            <div class="upload-text">é»æ“Šä¸Šå‚³ä½œå“åœ–ç‰‡</div>
                            <div class="upload-hint">æ”¯æ´ JPG, PNG, WebPï¼ˆæœ€å¤§ 10MBï¼Œè‡ªå‹•å„ªåŒ–ï¼‰</div>
                        </div>
                        <img class="portfolio-image-preview" id="preview-${portfolioItemCount}" style="display: none;" alt="Preview">
                        <input
                            type="file"
                            id="portfolio-image-${portfolioItemCount}"
                            accept="image/*"
                            style="display: none;"
                            onchange="handlePortfolioImageUpload(this, ${portfolioItemCount})"
                        >
                    </div>
                    <input type="hidden" name="portfolio-image[]" id="portfolio-image-data-${portfolioItemCount}">
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label>ä½¿ç”¨æŠ€è¡“</label>
                        <input type="text" name="portfolio-tech[]" placeholder="ä¾‹å¦‚ï¼šReact, Node.js">
                    </div>
                    <div class="form-field">
                        <label>å®Œæˆæ™‚é–“</label>
                        <input type="text" name="portfolio-date[]" placeholder="ä¾‹å¦‚ï¼š2024 å¹´ 3 æœˆ">
                    </div>
                </div>
            `;
            list.appendChild(item);
        }

        function removePortfolioItem(button) {
            const item = button.closest('.portfolio-item-block');
            item.remove();
            portfolioItemCount--;

            // é‡æ–°ç·¨è™Ÿ
            const items = document.querySelectorAll('.portfolio-item-title');
            items.forEach((title, index) => {
                title.textContent = `ä½œå“ #${index + 1}`;
            });
        }

        // ========================================
        // ç”Ÿæˆç¶²ç«™ï¼ˆå‘¼å«å¾Œç«¯ APIï¼‰
        // ========================================
        async function generateWebsite() {
            if (!validateStep2()) {
                alert('è«‹å…ˆå®Œæˆå¿…å¡«æ¬„ä½');
                previousStep(2);
                return;
            }

            // æ”¶é›†è¡¨å–®è³‡æ–™
            const formData = collectFormData();

            // é¡¯ç¤º Loading
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('active');

            // æ¨¡æ“¬é€²åº¦
            simulateProgress();

            try {
                // å‘¼å«å¾Œç«¯ API
                const response = await fetch('/api/generate-website', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showSuccess(result.site_id, result.preview_url, result.download_url, formData);
                } else {
                    const error = await response.text();
                    throw new Error(`ç”Ÿæˆå¤±æ•—: ${error}`);
                }
            } catch (error) {
                console.error('ç”Ÿæˆç¶²ç«™å¤±æ•—:', error);
                alert('ç¶²ç«™ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                loadingOverlay.classList.remove('active');
            }
        }

        function collectFormData() {
            // æ”¶é›†æœå‹™åˆ—è¡¨
            const services = [];
            document.querySelectorAll('input[name="service[]"]').forEach(input => {
                if (input.value.trim()) {
                    services.push(input.value.trim());
                }
            });

            // æ”¶é›†ä½œå“é›†
            const portfolio = [];
            const needPortfolio = document.getElementById('need-portfolio').checked;
            if (needPortfolio) {
                const portfolioNames = document.querySelectorAll('input[name="portfolio-name[]"]');
                const portfolioDescriptions = document.querySelectorAll('textarea[name="portfolio-description[]"]');
                const portfolioImages = document.querySelectorAll('input[name="portfolio-image[]"]');
                const portfolioTechs = document.querySelectorAll('input[name="portfolio-tech[]"]');
                const portfolioDates = document.querySelectorAll('input[name="portfolio-date[]"]');

                for (let i = 0; i < portfolioNames.length; i++) {
                    const item = {
                        title: portfolioNames[i].value,
                        description: portfolioDescriptions[i].value
                    };

                    // æ·»åŠ åœ–ç‰‡ï¼ˆå¦‚æœæœ‰ä¸Šå‚³ï¼‰
                    if (portfolioImages[i] && portfolioImages[i].value) {
                        item.image = portfolioImages[i].value; // Base64 æ ¼å¼
                    }

                    portfolio.push(item);
                }
            }

            // æ§‹å»ºç¬¦åˆå¾Œç«¯ API æœŸæœ›çš„æ ¼å¼
            // Backend expects: GenerateWebsiteRequest = { template_id, user_data, contact_email }
            const formData = {
                template_id: selectedStyle || 'modern-tech',
                user_data: {
                    company_name: document.getElementById('company-name').value,
                    tagline: document.getElementById('slogan').value,
                    description: document.getElementById('company-description').value,
                    services: services,
                    contact_phone: document.getElementById('contact-phone').value || '',
                    portfolio: portfolio,
                    custom_style: selectedStyle === 'custom' ? {
                        image: uploadedImage ? uploadedImage.split(',')[1] : null, // base64 without prefix
                        description: document.getElementById('custom-description')?.value || ''
                    } : null
                },
                contact_email: document.getElementById('contact-email').value
            };

            return formData;
        }

        function simulateProgress() {
            let progress = 0;
            const progressElement = document.getElementById('loading-progress');

            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) {
                    progress = 95;
                    clearInterval(interval);
                }
                progressElement.textContent = Math.floor(progress) + '%';
            }, 500);
        }

        async function showSuccess(siteId, previewUrl, downloadUrl, formData) {
            // éš±è— Loading
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.remove('active');

            // éš±è—æ‰€æœ‰æ­¥é©Ÿ
            document.querySelectorAll('.section-block').forEach(block => {
                block.classList.remove('active');
            });

            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            const successMessage = document.getElementById('success-message');
            successMessage.classList.add('active');

            // è¨­å®šç¶²ç«™ URL
            document.getElementById('website-url').textContent = previewUrl || 'https://aiinpocket.com/sites/demo';
            document.getElementById('visit-website').href = previewUrl || '#';

            // å¦‚æœæœ‰ä¸‹è¼‰ URLï¼Œæ·»åŠ ä¸‹è¼‰æŒ‰éˆ•
            if (downloadUrl) {
                const downloadBtn = document.createElement('a');
                downloadBtn.href = downloadUrl;
                downloadBtn.className = 'btn btn-secondary';
                downloadBtn.innerHTML = 'ä¸‹è¼‰å®Œæ•´ç‰ˆ<span>â¬‡</span>';
                downloadBtn.style.marginLeft = '1rem';

                const buttonContainer = document.querySelector('#success-message .btn-primary').parentElement;
                if (buttonContainer && !buttonContainer.querySelector('.btn-secondary')) {
                    buttonContainer.querySelector('.btn-primary').insertAdjacentElement('afterend', downloadBtn);
                }
            }

            // è‡ªå‹•å„²å­˜å°ˆæ¡ˆï¼ˆå¦‚æœå·²ç™»å…¥ï¼‰
            const session = UserSession.get();
            if (session && session.user_id && siteId && formData) {
                try {
                    console.log('[Auto-save] Attempting to save project...');

                    const saveResponse = await fetch('/api/projects', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: session.user_id,
                            project_name: formData.user_data.company_name || 'æœªå‘½åå°ˆæ¡ˆ',
                            template_id: formData.template_id,
                            form_data: formData.user_data,
                            site_id: siteId,
                            preview_url: previewUrl,
                            download_url: downloadUrl
                        })
                    });

                    const saveResult = await saveResponse.json();

                    if (saveResult.success) {
                        console.log('[Auto-save] Project saved successfully:', saveResult.project_id);

                        // åœ¨æˆåŠŸè¨Šæ¯ä¸­æ·»åŠ æç¤º
                        const successHint = document.createElement('p');
                        successHint.style.cssText = 'color: #7FFF00; margin-top: 1rem; font-size: 0.9rem;';
                        successHint.innerHTML = 'âœ… å°ˆæ¡ˆå·²è‡ªå‹•å„²å­˜åˆ°ã€Œæˆ‘çš„ä½œå“ã€';

                        const successTitle = successMessage.querySelector('h2');
                        if (successTitle && !successMessage.querySelector('p[style*="7FFF00"]')) {
                            successTitle.insertAdjacentElement('afterend', successHint);
                        }
                    } else {
                        console.warn('[Auto-save] Failed to save project:', saveResult.message);
                    }
                } catch (error) {
                    console.error('[Auto-save] Error saving project:', error);
                    // ä¸å½±éŸ¿ä¸»æµç¨‹ï¼Œåªè¨˜éŒ„éŒ¯èª¤
                }
            } else {
                console.log('[Auto-save] Skipped - User not logged in or missing data');
            }

            // æ»¾å‹•åˆ°é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // ä½¿ç”¨è€…èªè­‰ç³»çµ±
        // ========================================

        // Session ç®¡ç†
        const UserSession = {
            get() {
                const session = localStorage.getItem('user_session');
                return session ? JSON.parse(session) : null;
            },
            set(userData) {
                localStorage.setItem('user_session', JSON.stringify(userData));
            },
            clear() {
                localStorage.removeItem('user_session');
            },
            isLoggedIn() {
                return this.get() !== null;
            }
        };

        // ç™»å…¥ Modal
        function showLoginModal() {
            const modal = document.getElementById('login-modal');
            modal.style.display = 'flex';
        }

        function hideLoginModal() {
            const modal = document.getElementById('login-modal');
            modal.style.display = 'none';
            document.getElementById('login-email').value = '';
            document.getElementById('otp-code').value = '';
            document.getElementById('email-step').style.display = 'block';
            document.getElementById('otp-step').style.display = 'none';
        }

        // ç™¼é€ OTP
        async function sendOTP() {
            const email = document.getElementById('login-email').value.trim();
            if (!email) {
                alert('è«‹è¼¸å…¥ Email');
                return;
            }

            const sendBtn = document.getElementById('send-otp-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'ç™¼é€ä¸­...';

            try {
                const response = await fetch('/api/auth/send-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message);
                    document.getElementById('email-step').style.display = 'none';
                    document.getElementById('otp-step').style.display = 'block';
                } else {
                    alert('ç™¼é€å¤±æ•—ï¼š' + data.message);
                }
            } catch (error) {
                alert('ç™¼é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
                console.error('Send OTP error:', error);
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'ç™¼é€é©—è­‰ç¢¼';
            }
        }

        // é©—è­‰ OTP ä¸¦ç™»å…¥
        async function verifyOTP() {
            const email = document.getElementById('login-email').value.trim();
            const otpCode = document.getElementById('otp-code').value.trim();

            if (!otpCode) {
                alert('è«‹è¼¸å…¥é©—è­‰ç¢¼');
                return;
            }

            const verifyBtn = document.getElementById('verify-otp-btn');
            verifyBtn.disabled = true;
            verifyBtn.textContent = 'é©—è­‰ä¸­...';

            try {
                const response = await fetch('/api/auth/verify-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, otp_code: otpCode })
                });

                const data = await response.json();

                if (data.success) {
                    // å„²å­˜ session
                    UserSession.set({
                        user_id: data.user_id,
                        session_token: data.session_token,
                        email: data.user_info.email,
                        vip_level: data.user_info.vip_level,
                        max_projects: data.user_info.max_projects,
                        remaining_projects: data.user_info.remaining_projects
                    });

                    alert('ç™»å…¥æˆåŠŸï¼');
                    hideLoginModal();
                    updateUIForLoggedInUser();
                } else {
                    alert('é©—è­‰å¤±æ•—ï¼š' + data.message);
                }
            } catch (error) {
                alert('é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
                console.error('Verify OTP error:', error);
            } finally {
                verifyBtn.disabled = false;
                verifyBtn.textContent = 'é©—è­‰ä¸¦ç™»å…¥';
            }
        }

        // ç™»å‡º
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                UserSession.clear();
                updateUIForLoggedOutUser();
                alert('å·²ç™»å‡º');
            }
        }

        // æ›´æ–° UIï¼ˆå·²ç™»å…¥ï¼‰
        function updateUIForLoggedInUser() {
            const session = UserSession.get();
            if (!session) return;

            document.getElementById('login-btn').style.display = 'none';
            document.getElementById('user-email-display').style.display = 'inline-block';
            document.getElementById('user-email-display').textContent = session.email;
            document.getElementById('user-menu-item').style.display = 'inline-block';

            // æ·»åŠ ç™»å‡ºåŠŸèƒ½
            document.getElementById('user-email-display').onclick = logout;
        }

        // æ›´æ–° UIï¼ˆæœªç™»å…¥ï¼‰
        function updateUIForLoggedOutUser() {
            document.getElementById('login-btn').style.display = 'inline-block';
            document.getElementById('user-email-display').style.display = 'none';
            document.getElementById('user-menu-item').style.display = 'none';
        }

        // å°ˆæ¡ˆç®¡ç† Modal
        function showProjectsModal() {
            if (!UserSession.isLoggedIn()) {
                alert('è«‹å…ˆç™»å…¥');
                showLoginModal();
                return;
            }

            const modal = document.getElementById('projects-modal');
            modal.style.display = 'flex';
            loadProjects();
        }

        function hideProjectsModal() {
            const modal = document.getElementById('projects-modal');
            modal.style.display = 'none';
        }

        // è¼‰å…¥å°ˆæ¡ˆåˆ—è¡¨
        async function loadProjects() {
            const session = UserSession.get();
            if (!session) return;

            const projectsGrid = document.getElementById('projects-grid');
            projectsGrid.innerHTML = '<div style="text-align: center; padding: 2rem; color: #87CEEB;">è¼‰å…¥ä¸­...</div>';

            try {
                const response = await fetch(`/api/projects?user_id=${session.user_id}`);
                const data = await response.json();

                if (data.success && data.projects.length > 0) {
                    projectsGrid.innerHTML = data.projects.map(project => `
                        <div class="project-card" data-project-id="${project.id}">
                            <h3>${project.project_name}</h3>
                            <p>æ¨¡æ¿ï¼š${project.template_id}</p>
                            <p>ç‹€æ…‹ï¼š${project.status}</p>
                            <p>å»ºç«‹æ™‚é–“ï¼š${new Date(project.created_at).toLocaleDateString()}</p>
                            <div class="project-actions">
                                <button onclick="loadProject('${project.id}')" class="btn btn-primary btn-small">è¼‰å…¥</button>
                                <button onclick="deleteProject('${project.id}')" class="btn btn-secondary btn-small">åˆªé™¤</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    projectsGrid.innerHTML = '<div style="text-align: center; padding: 2rem; color: #87CEEB;">å°šç„¡å°ˆæ¡ˆ</div>';
                }
            } catch (error) {
                console.error('Load projects error:', error);
                projectsGrid.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ff6b6b;">è¼‰å…¥å¤±æ•—</div>';
            }
        }

        // è¼‰å…¥å°ˆæ¡ˆï¼ˆå¡«å…¥è¡¨å–®ï¼‰
        async function loadProject(projectId) {
            const session = UserSession.get();
            if (!session) return;

            try {
                const response = await fetch(`/api/projects/${projectId}?user_id=${session.user_id}`);
                const data = await response.json();

                if (data.success) {
                    const formData = data.project.form_data;

                    // å¡«å…¥åŸºæœ¬è³‡æ–™
                    document.getElementById('company-name').value = formData.company_name || '';
                    document.getElementById('slogan').value = formData.tagline || '';
                    document.getElementById('company-description').value = formData.description || '';
                    document.getElementById('contact-phone').value = formData.contact_phone || '';
                    document.getElementById('contact-email').value = session.email;

                    // å¡«å…¥æœå‹™é …ç›®
                    if (formData.services && Array.isArray(formData.services) && formData.services.length > 0) {
                        // æ¸…ç©ºç¾æœ‰æœå‹™åˆ—è¡¨
                        const servicesList = document.getElementById('services-list');
                        servicesList.innerHTML = '';

                        // æ·»åŠ æ¯å€‹æœå‹™
                        formData.services.forEach((service, index) => {
                            const serviceName = typeof service === 'string' ? service : (service.name || service.title || '');
                            const newItem = document.createElement('div');
                            newItem.className = 'list-item';
                            newItem.innerHTML = `
                                <input
                                    type="text"
                                    name="service[]"
                                    placeholder="è¼¸å…¥æœå‹™åç¨±"
                                    value="${serviceName}"
                                >
                                <button type="button" class="btn-remove" onclick="removeItem(this)">åˆªé™¤</button>
                            `;
                            servicesList.appendChild(newItem);
                        });
                    }

                    // å¡«å…¥ä½œå“é›†
                    if (formData.portfolio && Array.isArray(formData.portfolio) && formData.portfolio.length > 0) {
                        // ç¢ºä¿ä½œå“é›†å€åŸŸå±•é–‹
                        const needPortfolio = document.getElementById('need-portfolio');
                        if (!needPortfolio.checked) {
                            needPortfolio.checked = true;
                            togglePortfolio();
                        }

                        // æ¸…ç©ºç¾æœ‰ä½œå“é›†
                        const portfolioList = document.getElementById('portfolio-list');
                        portfolioList.innerHTML = '';
                        portfolioItemCount = 0;

                        // æ·»åŠ æ¯å€‹ä½œå“
                        formData.portfolio.forEach((item, index) => {
                            addPortfolioItem();
                            const itemId = portfolioItemCount;

                            // å¡«å…¥ä½œå“åç¨±
                            const nameInput = portfolioList.querySelector(`[data-item-id="${itemId}"] input[name="portfolio-name[]"]`);
                            if (nameInput) nameInput.value = item.title || '';

                            // å¡«å…¥ä½œå“æè¿°
                            const descInput = portfolioList.querySelector(`[data-item-id="${itemId}"] textarea[name="portfolio-description[]"]`);
                            if (descInput) descInput.value = item.description || '';

                            // å¡«å…¥ä½¿ç”¨æŠ€è¡“
                            const techInput = portfolioList.querySelector(`[data-item-id="${itemId}"] input[name="portfolio-tech[]"]`);
                            if (techInput && item.tech) techInput.value = item.tech;

                            // å¡«å…¥å®Œæˆæ™‚é–“
                            const dateInput = portfolioList.querySelector(`[data-item-id="${itemId}"] input[name="portfolio-date[]"]`);
                            if (dateInput && item.date) dateInput.value = item.date;

                            // å¡«å…¥åœ–ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
                            if (item.image) {
                                const imageData = portfolioList.querySelector(`#portfolio-image-data-${itemId}`);
                                if (imageData) {
                                    imageData.value = item.image;

                                    // é¡¯ç¤ºé è¦½
                                    const preview = document.getElementById(`preview-${itemId}`);
                                    const placeholder = document.getElementById(`placeholder-${itemId}`);
                                    if (preview && placeholder) {
                                        preview.src = item.image;
                                        preview.style.display = 'block';
                                        placeholder.style.display = 'none';
                                    }
                                }
                            }
                        });
                    }

                    hideProjectsModal();
                    alert('å°ˆæ¡ˆå·²è¼‰å…¥ï¼æ‰€æœ‰è³‡æ–™å·²å¡«å…¥è¡¨å–®ã€‚');

                    // è·³åˆ°æ­¥é©Ÿ 2
                    goToStep(2);
                } else {
                    alert('è¼‰å…¥å¤±æ•—ï¼š' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
                }
            } catch (error) {
                console.error('Load project error:', error);
                alert('è¼‰å…¥å¤±æ•—');
            }
        }

        // åˆªé™¤å°ˆæ¡ˆ
        async function deleteProject(projectId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å°ˆæ¡ˆå—ï¼Ÿ')) return;

            const session = UserSession.get();
            if (!session) return;

            try {
                const response = await fetch(`/api/projects/${projectId}?user_id=${session.user_id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert('å°ˆæ¡ˆå·²åˆªé™¤');
                    loadProjects(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
                } else {
                    alert('åˆªé™¤å¤±æ•—');
                }
            } catch (error) {
                console.error('Delete project error:', error);
                alert('åˆªé™¤å¤±æ•—');
            }
        }

        // åˆå§‹åŒ–èªè­‰ç³»çµ±
        document.addEventListener('DOMContentLoaded', function() {
            // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            if (UserSession.isLoggedIn()) {
                updateUIForLoggedInUser();
            } else {
                updateUIForLoggedOutUser();
            }

            // ç¶å®šäº‹ä»¶
            document.getElementById('login-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showLoginModal();
            });

            document.getElementById('my-projects-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showProjectsModal();
            });
        });
    </script>

    <!-- ç™»å…¥ Modal -->
    <div id="login-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #0a0e27, #1a1f3a); border: 2px solid #87CEEB; border-radius: 20px; padding: 3rem; max-width: 500px; width: 90%;">
            <h2 style="color: #7FFF00; margin-bottom: 2rem; text-align: center;">ç™»å…¥</h2>

            <!-- Email æ­¥é©Ÿ -->
            <div id="email-step">
                <div style="margin-bottom: 1.5rem;">
                    <label style="color: #87CEEB; display: block; margin-bottom: 0.5rem;">Email</label>
                    <input type="email" id="login-email" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email" style="width: 100%; padding: 1rem; border-radius: 10px; border: 2px solid rgba(135, 206, 235, 0.3); background: rgba(135, 206, 235, 0.05); color: white; font-size: 1rem;">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button onclick="sendOTP()" id="send-otp-btn" class="btn btn-primary" style="flex: 1;">ç™¼é€é©—è­‰ç¢¼</button>
                    <button onclick="hideLoginModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                </div>
            </div>

            <!-- OTP æ­¥é©Ÿ -->
            <div id="otp-step" style="display: none;">
                <p style="color: #87CEEB; margin-bottom: 1.5rem;">é©—è­‰ç¢¼å·²ç™¼é€åˆ°æ‚¨çš„ä¿¡ç®±ï¼Œè«‹åœ¨ 10 åˆ†é˜å…§è¼¸å…¥ï¼š</p>
                <div style="margin-bottom: 1.5rem;">
                    <label style="color: #87CEEB; display: block; margin-bottom: 0.5rem;">é©—è­‰ç¢¼</label>
                    <input type="text" id="otp-code" placeholder="è«‹è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼" maxlength="6" style="width: 100%; padding: 1rem; border-radius: 10px; border: 2px solid rgba(135, 206, 235, 0.3); background: rgba(135, 206, 235, 0.05); color: white; font-size: 1.5rem; text-align: center; letter-spacing: 0.5rem;">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button onclick="verifyOTP()" id="verify-otp-btn" class="btn btn-primary" style="flex: 1;">é©—è­‰ä¸¦ç™»å…¥</button>
                    <button onclick="hideLoginModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å°ˆæ¡ˆç®¡ç† Modal -->
    <div id="projects-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, #0a0e27, #1a1f3a); border: 2px solid #87CEEB; border-radius: 20px; padding: 3rem; max-width: 900px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #7FFF00; margin: 0;">æˆ‘çš„ä½œå“</h2>
                <button onclick="hideProjectsModal()" style="background: none; border: none; color: #87CEEB; font-size: 2rem; cursor: pointer;">&times;</button>
            </div>

            <div id="projects-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">
                <!-- å°ˆæ¡ˆå¡ç‰‡å°‡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <style>
        .project-card {
            background: rgba(135, 206, 235, 0.05);
            border: 2px solid rgba(135, 206, 235, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .project-card:hover {
            border-color: #7FFF00;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(127, 255, 0, 0.2);
        }

        .project-card h3 {
            color: #7FFF00;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .project-card p {
            color: #87CEEB;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .project-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
    </style>
</body>
</html>
